# Scheduling

Scheduling 是指如何安排 Pod 到哪個 Node 上。

在 pod 的 yaml 中，spec.nodeName 可以指定 pod 要跑在哪個 node 上。預設沒有這個 key，所以剛創建的 pod 會是 pending 的狀態。

Kubernetes 發現沒有這個 key 的 pod 後，會按照 scheduling algorithm 來安排 pod 放到哪個 node 上，並加入 nodeName。

## Manual Scheduling

如果不想要用 Kubernetes 自動安排 pod ，則根據以下兩種情況，可以手動指定 pod 要跑在哪個 node 上：

- 創建 pod
    - 在 yaml 中 spec.nodeName 指定 nodeName
- 已運行的 pod
    - 用 Pod 的 Binding API 提交 nodeName 變更

Binding API 的範例：

```yaml
apiVersion: v1
kind: Binding
metadata:
  name: mypod
target:
  apiVersion: v1
  kind: Pod
  name: mypod
  namespace: default
```

```
curl -k -X POST http://$server:$port/api/v1/namespaces/default/pods/mypod/binding -H "Content-Type: application/json" -d '{"apiVersion":"v1","kind":"Binding","metadata":{"name":"mypod"},"target":{"apiVersion":"v1","kind":"Pod","name":"mypod","namespace":"default"}}'
```

如果 describe pod 發現 pod 的 nodeName 是空的，則可能還沒有指派 pod 到 node 上。有可能是資源或權限的關係。


## Taints and Tolerations

Taint 是設定在 node 上，讓一般的 pod 不會被安排到這個 node 上。

Toleration 是設定在 pod 上，讓 pod 可以被安排到有 taint 的 node 上。

這個功能可以讓某些 node 專門跑某些特定的 pod，例如：

- 專門跑 GPU 的 node
- 專門跑高記憶體的 node
- 專門跑高 CPU 的 node

或是當 node 有問題時，把問題的 node 標記起來，讓 pod 不會被安排到這個 node 上。

Taint 有三種 effect: 

1. NoSchedule: 不會把 pod 安排到這個有 taint 的 node 上。除非 pod 有 Toleration。
2. PreferNoSchedule: 盡量不會把 pod 安排到這個有 taint 的 node 上。
3. NoExecute: 不會把 pod 安排到有 taint 的 node 上，並且會把已經在 node 上沒有 Toleration 的 pod 移除。

要注意，Toleration 不是說這個 Pod 一定可以被安排在對應 taint 的 node，而是說可以被安排在對應 taint 的 node 上。




